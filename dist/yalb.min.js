/*! yalb - v0.1.0 - 2015-02-14
* https://github.com/Fuzzyma/yalb
* Copyright (c) 2015 Ulrich-Matthias SchÃ¤fer; Licensed MIT */
!function(){var a=null,b=function(c,d){if(!(this instanceof b))return a&&a.yalb.dispatchEvent(new Event("close")),new b(c,d);a=this;var e={};d=d||{};for(var f in b.defaults)e[f]=d[f]||b.defaults[f];var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=[],y=e.current,z=document.createElement("div"),A=document.createElement("div");g=function(a){var b=document.createElement("span");return b.addEventListener("click",function(){z.dispatchEvent(new Event(a))},!1),b.className=a,b},h=function(){z.querySelector(".loader").classList.add("fadeOut"),z.querySelector(".error").classList.add("fadeOut")},i=function(){e.loop&&c.length>1||(y===c.length-1?z.querySelector(".next").classList.add("hide"):z.querySelector(".next").classList.remove("hide"),0===y?z.querySelector(".prev").classList.add("hide"):z.querySelector(".prev").classList.remove("hide"))},j=function(){z.querySelector("span.loader").classList.remove("fadeOut")},k=function(){z.querySelector("img.image").classList.add("fadeOut"),z.querySelector("span.loader").classList.add("fadeOut"),z.querySelector("strong.error").classList.remove("fadeOut"),n([y-1,y+1])},l=function(a){if(!a||a.target===z||"width"===a.propertyName){var b=x[y].img;b.className="image fadeOut",b.addEventListener("transitionend",function(){0==window.getComputedStyle(b).getPropertyValue("opacity")&&z.removeChild(b)},!1),z.appendChild(b),setTimeout(function(){b.classList.remove("fadeOut")},0),z.dispatchEvent(new CustomEvent("change",{detail:{index:y}})),n([y-1,y+1])}},m=function(a){if("string"==typeof a)return a;if(a instanceof Node&&0===e.src.indexOf("data-"))return a.dataset[e.src.substr(5).split("-").map(function(a,b){return b?a.charAt(0).toUpperCase()+a.slice(1):a}).join("")];for(var b=e.src.split("."),c=0,d=b.length;d>c;++c)a=a[b[c]];return a},n=function(a){a=a||[y];for(var b=a.length;b--;)e.loop&&a[b]<0&&(a[b]+=x.length),a[b]>=x.length||a[b]<0||x[a[b]].loaded||x[a[b]].pending||x[a[b]].error||(x[a[b]].img.src=m(c[a[b]]),x[a[b]].pending=!0)},o=function(){i(),x[y].loaded?p():x[y].error?k():(j(),n())},p=function(){if(h(),!z.querySelector(".image")||z.querySelector(".image").src!==x[y].img.src){z.querySelector(".image")&&z.querySelector(".image").classList.add("fadeOut");var a=x[y].img.naturalWidth/x[y].img.naturalHeight,b=x[y].img.naturalHeight,c=x[y].img.naturalWidth,d=e.height||window.innerHeight-40,f=e.width||window.innerWidth-40;b>d&&(b=d,c=a*d),c>f&&(c=f,b=f/a),Math.abs(parseInt(window.getComputedStyle(z).getPropertyValue("width"))-c)>1||Math.abs(parseInt(window.getComputedStyle(z).getPropertyValue("height"))-b)>1?(z.style.width=c+"px",z.style.height=b+"px",z.style.bottom=(b-window.innerHeight)/2+"px"):l()}},q=function(a){return function(){x[a].error=!0,a===y&&o()}},r=function(a){return function(){x[a].loaded=!0,a===y&&o()}},s=function(){y>0?(--y,o()):e.loop&&(y=x.length-1,o())},t=function(){y<c.length-1?(++y,o()):e.loop&&(y=0,o())},u=function(a){null!==a.detail.index&&(y=a.detail.index%x.length,o())},w=function(){A.classList.add("fadeOut")},v=function(){document.querySelector("body").appendChild(A),setTimeout(function(){A.classList.remove("fadeOut")},0),o()};var B={prev:s,next:t,close:w,show:u,open:v,transitionend:l},C={click:function(a){a.target===A&&z.dispatchEvent(new Event("close"))},transitionend:function(a){if(a.target===A&&0==window.getComputedStyle(A).getPropertyValue("opacity")){for(var b in B)z.removeEventListener(b,B[b],!1);for(var b in C)A.removeEventListener(b,C[b],!1);A.parentNode.removeChild(A)}}},D=document.createElement("span"),E=document.createElement("strong");D.className="loader fadeOut",E.className="error fadeOut",z.className=e["class"],z.appendChild(g("prev")),z.appendChild(g("next")),z.appendChild(g("close")),z.appendChild(D),z.appendChild(E),A.className=e["class"]+"_wrapper fadeOut",A.appendChild(z);for(var f in B)z.addEventListener(f,B[f],!1);for(var f in C)A.addEventListener(f,C[f],!1);this.yalb=z;for(var f=0,F=c.length;F>f;++f)x[f]={img:new Image,loaded:!1,pending:!1,error:!1},x[f].img.onload=r(f),x[f].img.onerror=q(f);return e.open&&(v(),o()),b};b.prev=function(){return a?(a.yalb.dispatchEvent(new Event("prev")),b):b},b.next=function(){return a?(a.yalb.dispatchEvent(new Event("next")),b):b},b.close=function(){return a?(a.yalb.dispatchEvent(new Event("close")),b):b},b.show=function(c){return a?(a.yalb.dispatchEvent(new CustomEvent("show",{detail:{index:c}})),b):b},b.open=function(){return a?(a.yalb.dispatchEvent(new Event("open")),b):b},b.get=function(){return a?a.yalb:b},b.defaults={src:"src",current:0,"class":"yalb",loop:!0,open:!0,width:0,height:0},window.yalb=b}();